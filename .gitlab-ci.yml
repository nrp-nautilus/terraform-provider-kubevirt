stages:
  - test
  - go-test
  - fetch-github-results

test:
  stage: test
  image: alpine:latest
  script:
    - echo "Hello World"
    - echo "Simple CI/CD test"
  rules:
    - if: $CI_COMMIT_TAG

go-test:
  stage: go-test
  image: golang:1.21-alpine
  before_script:
    - apk add --no-cache git wget unzip
    - wget -O terraform.zip https://releases.hashicorp.com/terraform/1.5.7/terraform_1.5.7_linux_amd64.zip
    - unzip terraform.zip
    - mv terraform /usr/local/bin/
    - terraform version
    - go mod download
    - go mod verify
  script:
    - echo "Running Go tests..."
    - go test -v ./...
    - echo "Running Go vet..."
    - go vet ./...
    - echo "Running Go fmt check..."
    - go fmt ./...
    - echo "âœ… Go tests completed successfully!"
  rules:
    - if: $CI_COMMIT_TAG

fetch-github-results:
  stage: fetch-github-results
  image: alpine:latest
  before_script:
    - apk add --no-cache curl jq
  script:
    - echo "Phase 3 Basic GitHub API check"
    - echo "Tag check stage"
    - echo "Checking GitHub API"
    - echo "Basic test will add GitHub logic later"
    - echo "Phase 3 completed successfully"
  rules:
    - if: $CI_COMMIT_TAG
  dependencies: []
